(function(){'use strict';const onLoad=(()=>{let a=!1,b=[];window.addEventListener("load",()=>{a=!0;b.forEach((a)=>{a()});b=[]});return(c)=>{a?setTimeout(c,0):b.push(c)}})();function ge(a){return document.getElementById(a)}function ce(a,b){var c=document.createElement(a);b&&(b.id&&(c.id=b.id),b.classList&&b.classList.forEach((a)=>c.classList.add(a)),b.children&&b.children.forEach((a)=>c.appendChild(a)),b.innerText&&(c.innerText=b.innerText));return c}
class ETarget{constructor(a){this.listeners=new Map;this.thisObject=a}addEventListener(a,b,c=!1){this.listeners.has(a)?this.listeners.get(a).push({isOnce:c,listener:b}):this.listeners.set(a,[{isOnce:c,listener:b}])}removeEventListener(a,b){if(!this.listeners.has(a))return{count:0};a=this.listeners.get(a);let c=0;for(let d=a.length-1;0<=d;d--)a[d].listener==b&&(a.splice(d,1),c++);return{count:c}}dispatchEvent(a,b){if(!this.listeners.has(a))return{count:0};const c=this.listeners.get(a).slice(),d=c.length;
for(let a=0;a<c.length;a++)c[a].listener.call(this.thisObject,b);a=this.listeners.get(a);for(b=a.length-1;0<=b;b--)a[b].isOnce&&a.splice(b,1);return{count:d}}}function padLeft(a,b,c){return c.charAt(0).repeat(b-a.length)+a}
function init(){return new Promise((a)=>{onLoad(()=>{const b=new ETarget(null);ge("new_btn").addEventListener("click",()=>b.dispatchEvent("add-new-item",null));a({setProgress,setPTime2Item,setETime2Item,setStatus2Item,getETime,getPTime,getTotalETime,getTotalPtime,addItem:addItem(b),removeItem,et:b})})})}function id2li(a){return ge("item-"+a)}function id2etime(a){return id2li(a).getElementsByClassName("todo_etime").item(0)}
function id2ptime(a){return id2li(a).getElementsByClassName("todo_ptime").item(0)}function t2s(a,b=!0){a<<=0;const c=a%60;a=a/60<<0;const d=a%60;return padLeft(((a/60<<0)%60).toString(),2," ")+":"+padLeft(d.toString(),2," ")+(b?":"+padLeft(c.toString(),2," "):"")}function s2t(a){a=a.split(":").map((a)=>parseInt(a));return 3<a.length||0>a.length||a.some((a)=>isNaN(a))?{success:!1,value:0}:{success:!0,value:a.reverse().reduce((a,c,d)=>a+c*Math.pow(60,d),0)}}
function setProgress(a,b){ge("progress_text").innerText=t2s(a,!1)+" / "+t2s(b,!1);a=0==b?0==a?0:100:a/b*100;ge("progress_bar").style.background=`linear-gradient(90deg, #b8e994 ${a}%, transparent ${a}%)`}function setPTime2Item(a,b){ptimeMap.set(a,b);id2ptime(a).value=t2s(b)}function setETime2Item(a,b){etimeMap.set(a,b);id2etime(a).value=t2s(b)}function setStatus2Item(a,b){ge(b?"done_ul":"todo_ul").appendChild(id2li(a))}
function addItem(a){return()=>{const b=performance.now().toString();createTodoItem(b,a);return b}}function removeItem(a){id2li(a).remove();ptimeMap.delete(a);etimeMap.delete(a)}
function createTodoItem(a,b){const c=(a,b,c,d=!1)=>{c=ce("input",{classList:c});c.type="text";c.title=a;c.placeholder=b;c.readOnly=d;return c},d=ce("button",{classList:["todo_dot"],innerText:"\u30fb"}),e=ce("button",{classList:["todo_done"],innerText:"\u2714"}),h=ce("button",{classList:["todo_remove"],innerText:"\u2718"}),l=c("Title","Title",["grow","shrink","todo_title"]),k=c("Elapsed time","",["todo_etime"],!0),f=c("Predetermined time","",["todo_ptime"]),g=ce("li",{id:"item-"+a,classList:["cH"],
children:[d,e,h,l,k,f]});d.addEventListener("click",()=>b.dispatchEvent("done-item",{itemID:a}));e.addEventListener("click",()=>b.dispatchEvent("undone-item",{itemID:a}));h.addEventListener("click",()=>b.dispatchEvent("remove-item",{itemID:a}));k.addEventListener("click",()=>{g.classList.toggle("running");g.classList.contains("running")?b.dispatchEvent("start-timer",{itemID:a}):b.dispatchEvent("pause-timer",{itemID:a})});f.addEventListener("keyup",(c)=>{13==c.keyCode&&(c=s2t(f.value),c.success?(setPTime2Item(a,
c.value),b.dispatchEvent("onchange-ptime",{time:c.value,itemID:a})):setPTime2Item(a,ptimeMap.get(a)||0))});ge("todo_ul").appendChild(g)}const etimeMap=new Map,ptimeMap=new Map;function getTotalPtime(){let a=0;for(const [,b]of ptimeMap)a+=b;return a}function getTotalETime(){let a=0;for(const [,b]of etimeMap)a+=b;return a}function getPTime(a){return ptimeMap.get(a)||0}function getETime(a){return etimeMap.get(a)||0}function Init(){return Promise.all([init()]).then((a)=>a[0])}
Init().then((a)=>{a.et.addEventListener("add-new-item",()=>a.addItem());a.et.addEventListener("done-item",(b)=>a.setStatus2Item(b.itemID,!0));a.et.addEventListener("undone-item",(b)=>a.setStatus2Item(b.itemID,!1));a.et.addEventListener("remove-item",(b)=>{a.removeItem(b.itemID);a.setProgress(a.getTotalETime(),a.getTotalPtime())});a.et.addEventListener("onchange-ptime",(b)=>{a.setProgress(a.getTotalETime(),a.getTotalPtime())});const b=new Map;a.et.addEventListener("pause-timer",(a)=>{a=a.itemID;performance.now();
b.has(a)?(clearInterval(b.get(a)),b.delete(a)):console.error("\u306a\u305c\u3001\u3053\u306e\u30bf\u30a4\u30de\u30fc\u304c\u6b7b\u3093\u3067\u3044\u308b\u306e\u304b\u3001\u305d\u308c\u304c\u7591\u554f\u3060\u3002")});a.et.addEventListener("start-timer",(c)=>{const d=c.itemID,e=performance.now()-1E3*a.getETime(d);b.has(d)&&(console.error("\u306a\u305c\u3001\u3053\u306e\u30bf\u30a4\u30de\u30fc\u304c\u751f\u304d\u6b8b\u3063\u3066\u3044\u308b\u306e\u304b\u3001\u305d\u308c\u304c\u7591\u554f\u3060\u3002"),
clearInterval(b.get(d)));b.set(d,setInterval(()=>{a.setETime2Item(d,(performance.now()-e)/1E3);a.setProgress(a.getTotalETime(),a.getTotalPtime())},100))})});})()
